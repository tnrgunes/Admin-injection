<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>Inkjection | Secure Admin</title>
    
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <link rel="apple-touch-icon" href="https://i.postimg.cc/kX47vXzS/tattoo-icon.png">

    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore-compat.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">
    <style>
        :root { --bg: #000; --card: #121212; --accent: #fff; --red: #ff3b30; --blue: #007aff; --gray: #2c2c2e; }
        * { -webkit-tap-highlight-color: transparent; }
        body { font-family: -apple-system, sans-serif; background: var(--bg); color: #fff; margin: 0; padding: env(safe-area-inset-top) 0 env(safe-area-inset-bottom) 0; min-height: 100vh; display: flex; align-items: center; justify-content: center; overflow-x: hidden; }
        #auth-container { width: 100%; max-width: 350px; text-align: center; padding: 20px; }
        #user-select { display: flex; flex-direction: column; gap: 15px; }
        .user-choice-btn { background: var(--card); border: 1px solid var(--gray); color: #fff; padding: 25px; border-radius: 20px; font-size: 18px; font-weight: 700; cursor: pointer; transition: 0.3s; letter-spacing: 2px; }
        #pin-screen { display: none; }
        .pin-input { width: 100%; padding: 18px; background: var(--card); border: 1px solid var(--gray); border-radius: 16px; color: #fff; font-size: 20px; text-align: center; letter-spacing: 8px; margin: 20px 0; outline: none; }
        #admin-panel { display: none; width: 100%; max-width: 500px; padding: 15px; align-self: flex-start; box-sizing: border-box; }
        .header { text-align: center; padding: 25px 0; border-bottom: 1px solid var(--gray); margin-bottom: 25px; }
        .user-badge { font-size: 10px; color: var(--blue); letter-spacing: 2px; text-transform: uppercase; font-weight: 700; display: block; }
        .tabs { display: flex; gap: 10px; margin-bottom: 25px; }
        .tab-btn { flex: 1; padding: 14px; border-radius: 14px; border: 1px solid var(--gray); background: var(--card); color: #8e8e93; cursor: pointer; font-size: 13px; font-weight: 700; }
        .tab-btn.active { background: var(--accent); color: #000; border-color: var(--accent); }
        .section { display: none; }
        .section.active { display: block; }
        .cal-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px; background: var(--card); padding: 10px; border-radius: 12px; }
        .days-grid { display: grid; grid-template-columns: repeat(7, 1fr); gap: 8px; }
        .day { aspect-ratio: 1/1; display: flex; align-items: center; justify-content: center; background: var(--card); border-radius: 12px; font-size: 14px; cursor: pointer; border: 1px solid transparent; }
        .day.past { opacity: 0.2; pointer-events: none; }
        .day.today { border-color: var(--blue); color: var(--blue); font-weight: 800; }
        .day.booked { background: rgba(255, 59, 48, 0.15); border-color: var(--red); color: var(--red); font-weight: 700; }
        .day.other-month { opacity: 0; pointer-events: none; }
        .media-box { background: var(--card); padding: 20px; border-radius: 20px; border: 1px solid var(--gray); margin-bottom: 25px; }
        .external-link { display: flex; align-items: center; justify-content: center; gap: 10px; background: var(--blue); color: #fff; text-decoration: none; padding: 15px; border-radius: 12px; font-weight: 700; font-size: 14px; margin-bottom: 20px; }
        .gallery-grid { display: grid; grid-template-columns: repeat(3, 1fr); gap: 12px; }
        .img-card { position: relative; aspect-ratio: 1/1; border-radius: 14px; overflow: hidden; background: var(--card); }
        .img-card img { width: 100%; height: 100%; object-fit: cover; }
        .del-btn { position: absolute; top: 5px; right: 5px; background: rgba(0,0,0,0.6); border: none; color: var(--red); border-radius: 5px; padding: 5px; }
        input[type="text"] { width: 100%; padding: 16px; border-radius: 12px; border: 1px solid var(--gray); background: #000; color: #fff; margin: 10px 0; box-sizing: border-box; }
        .btn-white { width: 100%; padding: 16px; border-radius: 12px; border: none; background: #fff; color: #000; font-weight: 800; cursor: pointer; }
    </style>
</head>
<body>

<div id="auth-container">
    <div style="font-size: 24px; font-weight: 800; letter-spacing: 6px; margin-bottom: 40px;">INKJECTION</div>
    <div id="user-select">
        <button class="user-choice-btn" onclick="selectUser('Taner')">TANER</button>
        <button class="user-choice-btn" onclick="selectUser('Talitha')">TALITHA</button>
    </div>
    <div id="pin-screen">
        <div id="pin-title" style="font-size: 12px; color: #888; letter-spacing: 2px;"></div>
        <input type="password" id="admin-pin" class="pin-input" maxlength="4" placeholder="••••" pattern="\d*" inputmode="numeric" oninput="validatePin(this.value)">
        <button onclick="goBack()" style="background:none; border:none; color:#444; font-size:12px; cursor:pointer;"><i class="fas fa-arrow-left"></i> GO BACK</button>
    </div>
</div>

<div id="admin-panel">
    <div class="header">
        <h1 style="margin:0; font-size: 20px; letter-spacing: 5px;">INKJECTION</h1>
        <span id="welcome-user" class="user-badge"></span>
    </div>
    <div class="tabs">
        <button class="tab-btn active" onclick="switchTab('tab-cal', this)">CALENDAR</button>
        <button class="tab-btn" onclick="switchTab('tab-gal', this)">GALLERY</button>
    </div>
    <div id="tab-cal" class="section active">
        <div class="cal-header">
            <button onclick="changeMonth(-1)" style="background:none; border:none; color:#fff;"><i class="fas fa-chevron-left"></i></button>
            <h3 id="monthDisplay"></h3>
            <button onclick="changeMonth(1)" style="background:none; border:none; color:#fff;"><i class="fas fa-chevron-right"></i></button>
        </div>
        <div class="days-grid" id="adminDays"></div>
    </div>
    <div id="tab-gal" class="section">
        <div class="media-box">
            <a href="https://postimages.org/" target="_blank" class="external-link"><i class="fas fa-upload"></i> OPEN POSTIMAGES</a>
            <input type="text" id="img-url" placeholder="Paste Direct Link here...">
            <button class="btn-white" onclick="savePhoto()">PUBLISH PHOTO</button>
        </div>
        <div class="gallery-grid" id="adminGallery"></div>
    </div>
    <button onclick="location.reload()" style="width:100%; padding:40px; background:none; border:none; color:#444; font-size:11px; cursor:pointer;">LOGOUT</button>
</div>

<script>
    const firebaseConfig = { apiKey: "AIzaSyA5e7A-Ha8dJWj5dUE_j_g3WeD0QhrDkZY", authDomain: "inkjection-admin.firebaseapp.com", projectId: "inkjection-admin", storageBucket: "inkjection-admin.firebasestorage.app", messagingSenderId: "272546510196", appId: "1:272546510196:web:ac81ad4ce4c3ce1db82821" };
    firebase.initializeApp(firebaseConfig);
    const db = firebase.firestore();

    let selectedUser = "";
    const userAccess = { "Taner": "2135", "Talitha": "2808" };
    const now = new Date();
    const realToday = new Date(now.getFullYear(), now.getMonth(), now.getDate());
    let currentMonth = now.getMonth(), currentYear = now.getFullYear();
    let blockedDates = new Set();

    function selectUser(user) {
        selectedUser = user;
        document.getElementById('user-select').style.display = 'none';
        document.getElementById('pin-screen').style.display = 'block';
        document.getElementById('pin-title').innerText = `ENTER PIN FOR ${user.toUpperCase()}`;
        document.getElementById('admin-pin').focus();
    }

    function goBack() {
        document.getElementById('user-select').style.display = 'flex';
        document.getElementById('pin-screen').style.display = 'none';
        document.getElementById('admin-pin').value = '';
    }

    function validatePin(val) {
        if(val === userAccess[selectedUser]) {
            document.getElementById('auth-container').style.display = 'none';
            document.getElementById('admin-panel').style.display = 'block';
            document.getElementById('welcome-user').innerText = `Welcome, ${selectedUser}`;
            loadBlockedDates();
        } else if (val.length === 4) {
            alert("Incorrect PIN!");
            document.getElementById('admin-pin').value = '';
        }
    }

    async function loadBlockedDates() {
        const snap = await db.collection("blockedDays").get();
        blockedDates.clear();
        snap.forEach(doc => blockedDates.add(doc.id));
        renderCalendar();
    }

    function renderCalendar() {
        const grid = document.getElementById('adminDays');
        const months = ["JANUARY","FEBRUARY","MARCH","APRIL","MAY","JUNE","JULY","AUGUST","SEPTEMBER","OCTOBER","NOVEMBER","DECEMBER"];
        document.getElementById('monthDisplay').innerText = `${months[currentMonth]} ${currentYear}`;
        grid.innerHTML = "";
        const firstDay = new Date(currentYear, currentMonth, 1).getDay();
        const shift = (firstDay === 0 ? 6 : firstDay - 1);
        const totalDays = new Date(currentYear, currentMonth + 1, 0).getDate();
        for(let i=0; i<shift; i++) grid.innerHTML += `<div class="day other-month"></div>`;
        for(let d=1; d<=totalDays; d++) {
            const thisDate = new Date(currentYear, currentMonth, d);
            const dateStr = `${currentYear}-${(currentMonth+1).toString().padStart(2,'0')}-${d.toString().padStart(2,'0')}`;
            const isBooked = blockedDates.has(dateStr);
            const isPast = thisDate < realToday;
            grid.innerHTML += `<div class="day ${isPast?'past':''} ${thisDate.getTime()===realToday.getTime()?'today':''} ${isBooked?'booked':''}" onclick="${!isPast ? `toggleDate('${dateStr}', ${isBooked})` : ''}">${d}</div>`;
        }
    }

    async function toggleDate(dateStr, currentlyBooked) {
        if(confirm(`Are you sure you want to ${currentlyBooked ? 'OPEN' : 'BLOCK'} ${dateStr}?`)) {
            const ref = db.collection("blockedDays").doc(dateStr);
            if(currentlyBooked) await ref.delete(); else await ref.set({status: 'booked'});
            loadBlockedDates();
        }
    }

    function changeMonth(dir) {
        currentMonth += dir;
        if(currentMonth > 11) { currentMonth = 0; currentYear++; } else if(currentMonth < 0) { currentMonth = 11; currentYear--; }
        renderCalendar();
    }

    function switchTab(id, btn) {
        document.querySelectorAll('.section').forEach(s => s.classList.remove('active'));
        document.querySelectorAll('.tab-btn').forEach(b => b.classList.remove('active'));
        document.getElementById(id).classList.add('active');
        btn.classList.add('active');
        if(id === 'tab-gal') fetchGallery();
    }

    async function fetchGallery() {
        const grid = document.getElementById('adminGallery');
        const snap = await db.collection("photos").orderBy("createdAt", "desc").get();
        grid.innerHTML = "";
        snap.forEach(doc => {
            grid.innerHTML += `<div class="img-card"><img src="${doc.data().url}"><button class="del-btn" onclick="deletePhoto('${doc.id}')"><i class="fas fa-trash"></i></button></div>`;
        });
    }

    async function savePhoto() {
        const url = document.getElementById('img-url').value;
        if(url && confirm("Are you sure you want to publish this photo?")) {
            await db.collection("photos").add({ url, createdAt: firebase.firestore.FieldValue.serverTimestamp() });
            document.getElementById('img-url').value = ""; fetchGallery();
        }
    }

    async function deletePhoto(id) {
        if(confirm("Are you sure you want to delete this photo?")) { await db.collection("photos").doc(id).delete(); fetchGallery(); }
    }
</script>
</body>
</html>
